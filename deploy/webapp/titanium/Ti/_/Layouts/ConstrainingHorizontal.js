define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,d){var o=d.isDef,a=Math.round;return t("Ti._.Layouts.ConstrainingHorizontal",e,{_doLayout:function(e,t,d,o,h){var r,n,_,s,x,u,g,f,l,m,b,N,p,W,c,y,H,L={width:0,height:0},S=e._children,w=0,I="px",T=[],C=0,z=0,E=S.length,F=this._measureNode;for(w=0;E>w;w++)r=e._children[w],r._alive&&r.domNode?r._markedForLayout&&((r._preLayout&&r._preLayout(t,d,o,h)||r._needsMeasuring)&&F(r,r,r._layoutCoefficients,this),n=r._layoutCoefficients,_=n.width,0===_.x2||isNaN(_.x2)?(s=n.height,x=n.sandboxWidth,u=n.sandboxHeight,b=s.x1*d+s.x2,m=_.x1*t+_.x2*(t-C)+_.x3,l=r._getContentSize?r._getContentSize(m,b):r._layout._doLayout(r,isNaN(m)?t:m-r._borderLeftWidth-r._borderRightWidth,isNaN(b)?d:b-r._borderTopWidth-r._borderBottomWidth,isNaN(m),isNaN(b)),isNaN(m)&&(m=l.width+r._borderLeftWidth+r._borderRightWidth),isNaN(b)&&(b=l.height+r._borderTopWidth+r._borderBottomWidth),p=r._measuredSandboxWidth=x.x1*t+x.x2+m,C+=p,r._measuredWidth=m,r._measuredHeight=b):z++):this.handleInvalidState(r,e);for(y=t-C,C=Math.floor(y/z),w=0;E>w;w++)r=e._children[w],r._markedForLayout&&(n=r._layoutCoefficients,_=n.width,0===_.x2||isNaN(_.x2)||(s=n.height,x=n.sandboxWidth,u=n.sandboxHeight,b=s.x1*d+s.x2,m=_.x1*t+_.x2*(E-1>w?C:y-C*(z-1))+_.x3,l=r._getContentSize?r._getContentSize(m,b):r._layout._doLayout(r,isNaN(m)?t:m-r._borderLeftWidth-r._borderRightWidth,isNaN(b)?d:b-r._borderTopWidth-r._borderBottomWidth,isNaN(m),isNaN(b)),isNaN(m)&&(m=l.width+r._borderLeftWidth+r._borderRightWidth),isNaN(b)&&(b=l.height+r._borderTopWidth+r._borderBottomWidth),r._measuredWidth=m,r._measuredHeight=b,p=r._measuredSandboxWidth=x.x1*t+x.x2+m));for(C=0,w=0;E>w;w++)r=e._children[w],r._measuredRunningWidth=C,r._markedForLayout?(n=r._layoutCoefficients,u=n.sandboxHeight,g=n.top,f=n.left,h&&0!==g.x1?T.push(r):(b=r._measuredHeight,c=r._measuredTop=g.x1*d+g.x2*b+g.x3,N=r._measuredSandboxHeight=u.x1*d+u.x2+b+(isNaN(c)?0:c),r._measuredSandboxHeight>L.height&&(L.height=r._measuredSandboxHeight)),W=r._measuredLeft=f.x1*t+f.x2+C):r._measuredSandboxHeight>L.height&&(L.height=r._measuredSandboxHeight),C+=r._measuredSandboxWidth;for(L.width=C,E=T.length,w=0;E>w;w++)r=T[w],u=r._layoutCoefficients.sandboxHeight,N=r._measuredSandboxHeight=u.x1*d+u.x2+r._measuredHeight,N>L.height&&(L.height=N);for(w=0;E>w;w++)r=T[w],g=r._layoutCoefficients.top,u=r._layoutCoefficients.sandboxHeight,b=r._measuredHeight,N=r._measuredSandboxHeight,N>L.height&&(L.height=N),c=r._measuredTop=g.x1*L.height+g.x2*b+g.x3,r._measuredSandboxHeight+=isNaN(c)?0:c;for(E=S.length,w=0;E>w;w++)r=S[w],r._markedForLayout&&(i._elementLayoutCount++,r=S[w],H=r.domNode.style,H.zIndex=r.zIndex,H.left=a(r._measuredLeft)+I,H.top=a(r._measuredTop)+I,H.width=a(r._measuredWidth-r._borderLeftWidth-r._borderRightWidth)+I,H.height=a(r._measuredHeight-r._borderTopWidth-r._borderBottomWidth)+I,r._markedForLayout=!1,r.fireEvent("postlayout"));return this._computedSize=L},_getWidth:function(e,t){return!o(t)&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:t},_getHeight:function(e,t){return!o(t)&&o(e.top)+o(e.center&&e.center.y)+o(e.bottom)<2&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.width.x2)&&0!==t.width.x2||!isNaN(t.height.x1)&&0!==t.height.x1||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,d=e._parent._measuredHeight,o=e._measuredRunningWidth,a=t.height.x1*d+t.height.x2;return{width:t.width.x1*i+t.width.x2*(i-o)+t.width.x3,height:a,left:t.left.x1*i+t.left.x2+o,top:t.top.x1*d+t.top.x2*a+t.top.x3}},_measureNode:function(e,t,d,o){e._needsMeasuring=!1;var a,h,r,n=o.getValueType,_=o.computeValue,s=o._getWidth(e,t.width),x=n(s),u=_(s,x),g=o._getHeight(e,t.height),f=n(g),l=_(g,f),m=t.left,b=n(m),N=_(m,b),p=t.right,W=n(p),c=_(p,W),y=t.top,H=n(y),L=_(y,H),S=t.center&&t.center.y,w=n(S),I=_(S,w),T=t.bottom,C=n(T),z=_(T,C),E=d.width,F=d.height,R=d.sandboxWidth,v=d.sandboxHeight,k=d.left,B=d.top;if(a=h=0,f===i.SIZE?a=h=0/0:f===i.FILL?(a=1,"%"===H?a-=L:"#"===H?h=-L:"%"===C?a-=z:"#"===C&&(h=-z)):"%"===f?a=l:"#"===f?h=l:"%"===H?"%"===w?a=2*(I-L):"#"===w?(a=-2*L,h=2*I):"%"===C?a=1-L-z:"#"===C&&(a=1-L,h=-z):"#"===H?"%"===w?(a=2*I,h=-2*L):"#"===w?h=2*(I-L):"%"===C?(a=1-z,h=-L):"#"===C&&(a=1,h=-z-L):"%"===w?"%"===C?a=2*(z-I):"#"===C&&(a=-2*I,h=2*z):"#"===w&&("%"===C?(a=2*z,h=-2*I):"#"===C&&(h=2*(z-I))),F.x1=a,F.x2=h,v.x1="%"===C?z:0,v.x2="#"===C?z:0,a=h=r=0,x===i.SIZE?a=h=r=0/0:x===i.FILL?(h=1,"%"===b&&(a=-N),"#"===b&&(r=-N),"%"===W&&(a=-c),"#"===W&&(r=-c)):"%"===x?a=u:"#"===x&&(r=u),E.x1=a,E.x2=h,E.x3=r,a=h=0,"%"===b&&(a=N),"#"===b&&(h=N),"%"===W&&(a+=c),"#"===W&&(h+=c),R.x1=a,R.x2=h,a=h=r=0,"%"===H)a=L;else if("#"===H)r=L;else if("%"===w)a=I,h=-.5;else if("#"===w)h=-.5,r=I;else if("%"===C)a=1-z,h=-1;else if("#"===C)a=1,h=-1,r=-z;else switch(o._defaultVerticalAlignment){case"center":a=.5,h=-.5;break;case"end":a=1,h=-1}B.x1=a,B.x2=h,B.x3=r,k.x1="%"===b?N:0,k.x2="#"===b?N:0},_defaultHorizontalAlignment:"start",_defaultVerticalAlignment:"center"})});