define(["Ti/_/Layouts/Base","Ti/_/declare","Ti/UI","Ti/_/lang"],function(e,t,i,d){var a=d.isDef,o=Math.round;return t("Ti._.Layouts.ConstrainingVertical",e,{_doLayout:function(e,t,d,a,r){var h,n,_,s,x,u,g,f,l,m,W,b,N,p,c,L,y,w={width:0,height:0},S=e._children,H=0,I="px",T=[],C=0,z=0,E=S.length,F=this._measureNode;for(H=0;E>H;H++)h=e._children[H],h._alive&&h.domNode?h._markedForLayout&&((h._preLayout&&h._preLayout(t,d,a,r)||h._needsMeasuring)&&F(h,h,h._layoutCoefficients,this),n=h._layoutCoefficients,s=n.height,0===s.x2||isNaN(s.x2)?(_=n.width,x=n.sandboxWidth,u=n.sandboxHeight,m=_.x1*t+_.x2,W=s.x1*d+s.x2*(d-C)+s.x3,l=h._getContentSize?h._getContentSize(m,W):h._layout._doLayout(h,isNaN(m)?t:m-h._borderLeftWidth-h._borderRightWidth,isNaN(W)?d:W-h._borderTopWidth-h._borderBottomWidth,isNaN(m),isNaN(W)),isNaN(m)&&(m=l.width+h._borderLeftWidth+h._borderRightWidth),isNaN(W)&&(W=l.height+h._borderTopWidth+h._borderBottomWidth),b=h._measuredSandboxHeight=u.x1*d+u.x2+W,C+=b,h._measuredWidth=m,h._measuredHeight=W):z++):this.handleInvalidState(h,e);for(L=d-C,C=Math.floor(L/z),H=0;E>H;H++)h=e._children[H],h._markedForLayout&&(n=h._layoutCoefficients,s=n.height,0===s.x2||isNaN(s.x2)||(_=n.width,x=n.sandboxWidth,u=n.sandboxHeight,m=_.x1*t+_.x2,W=s.x1*d+s.x2*(E-1>H?C:L-C*(z-1))+s.x3,l=h._getContentSize?h._getContentSize(m,W):h._layout._doLayout(h,isNaN(m)?t:m-h._borderLeftWidth-h._borderRightWidth,isNaN(W)?d:W-h._borderTopWidth-h._borderBottomWidth,isNaN(m),isNaN(W)),isNaN(m)&&(m=l.width+h._borderLeftWidth+h._borderRightWidth),isNaN(W)&&(W=l.height+h._borderTopWidth+h._borderBottomWidth),h._measuredWidth=m,h._measuredHeight=W,b=h._measuredSandboxHeight=u.x1*d+u.x2+W));for(C=0,H=0;E>H;H++)h=e._children[H],h._measuredRunningHeight=C,h._markedForLayout?(n=h._layoutCoefficients,x=n.sandboxWidth,g=n.top,f=n.left,a&&0!==f.x1?T.push(h):(m=h._measuredWidth,p=h._measuredLeft=f.x1*t+f.x2*m+f.x3,N=h._measuredSandboxWidth=x.x1*t+x.x2+m+(isNaN(p)?0:p),h._measuredSandboxWidth>w.width&&(w.width=h._measuredSandboxWidth)),c=h._measuredTop=g.x1*d+g.x2+C):h._measuredSandboxWidth>w.width&&(w.width=h._measuredSandboxWidth),C+=h._measuredSandboxHeight;for(w.height=C,E=T.length,H=0;E>H;H++)h=T[H],x=h._layoutCoefficients.sandboxWidth,N=h._measuredSandboxWidth=x.x1*t+x.x2+h._measuredWidth,N>w.width&&(w.width=N);for(H=0;E>H;H++)h=T[H],f=h._layoutCoefficients.left,x=h._layoutCoefficients.sandboxWidth,m=h._measuredWidth,N=h._measuredSandboxWidth,N>w.width&&(w.width=N),p=h._measuredLeft=f.x1*w.width+f.x2*m+f.x3,h._measuredSandboxWidth+=isNaN(p)?0:p;for(E=S.length,H=0;E>H;H++)h=S[H],h._markedForLayout&&(i._elementLayoutCount++,h=S[H],y=h.domNode.style,y.zIndex=h.zIndex,y.left=o(h._measuredLeft)+I,y.top=o(h._measuredTop)+I,y.width=o(h._measuredWidth-h._borderLeftWidth-h._borderRightWidth)+I,y.height=o(h._measuredHeight-h._borderTopWidth-h._borderBottomWidth)+I,h._markedForLayout=!1,h.fireEvent("postlayout"));return this._computedSize=w},_getWidth:function(e,t){return!a(t)&&a(e.left)+a(e.center&&e.center.x)+a(e.right)<2&&(t=e._defaultWidth),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getWidth(e._parent,e._parent.width)===i.SIZE?i.SIZE:i.FILL:t},_getHeight:function(e,t){return!a(t)&&(t=e._defaultHeight),t===i.INHERIT?e._parent._parent&&e._parent._parent._layout._getHeight(e._parent,e._parent.height)===i.SIZE?i.SIZE:i.FILL:t},_isDependentOnParent:function(e){var t=e._layoutCoefficients;return!isNaN(t.width.x1)&&0!==t.width.x1||!isNaN(t.height.x1)&&0!==t.height.x1||!isNaN(t.height.x2)&&0!==t.height.x2||0!==t.sandboxWidth.x1||0!==t.sandboxHeight.x1||0!==t.left.x1||0!==t.top.x1},_doAnimationLayout:function(e,t){var i=e._parent._measuredWidth,d=e._parent._measuredHeight,a=e._measuredRunningHeight,o=t.width.x1*i+t.width.x2;return{width:o,height:t.height.x1*d+t.height.x2*(d-a)+t.height.x3,left:t.left.x1*i+t.left.x2*o+t.left.x3,top:t.top.x1*d+t.top.x2+a}},_measureNode:function(e,t,d,a){e._needsMeasuring=!1;var o,r,h,n=a.getValueType,_=a.computeValue,s=a._getWidth(e,t.width),x=n(s),u=_(s,x),g=a._getHeight(e,t.height),f=n(g),l=_(g,f),m=t.left,W=n(m),b=_(m,W),N=t.center&&t.center.x,p=n(N),c=_(N,p),L=t.right,y=n(L),w=_(L,y),S=t.top,H=n(S),I=_(S,H),T=t.bottom,C=n(T),z=_(T,C),E=d.width,F=d.height,R=d.sandboxWidth,v=d.sandboxHeight,k=d.left,B=d.top;if(o=r=0,x===i.SIZE?o=r=0/0:x===i.FILL?(o=1,"%"===W?o-=b:"#"===W?r=-b:"%"===y?o-=w:"#"===y&&(r=-w)):"%"===x?o=u:"#"===x?r=u:"%"===W?"%"===p?o=2*(c-b):"#"===p?(o=-2*b,r=2*c):"%"===y?o=1-b-w:"#"===y&&(o=1-b,r=-w):"#"===W?"%"===p?(o=2*c,r=-2*b):"#"===p?r=2*(c-b):"%"===y?(o=1-w,r=-b):"#"===y&&(o=1,r=-w-b):"%"===p?"%"===y?o=2*(w-c):"#"===y&&(o=-2*c,r=2*w):"#"===p&&("%"===y?(o=2*w,r=-2*c):"#"===y&&(r=2*(w-c))),E.x1=o,E.x2=r,R.x1="%"===y?w:0,R.x2="#"===y?w:0,o=r=h=0,f===i.SIZE?o=r=h=0/0:f===i.FILL?(r=1,"%"===H&&(o=-I),"#"===H&&(h=-I),"%"===C&&(o=-z),"#"===C&&(h=-z)):"%"===f?o=l:"#"===f&&(h=l),F.x1=o,F.x2=r,F.x3=h,o=r=0,"%"===H&&(o=I),"#"===H&&(r=I),"%"===C&&(o+=z),"#"===C&&(r+=z),v.x1=o,v.x2=r,o=r=h=0,"%"===W)o=b;else if("#"===W)h=b;else if("%"===p)o=c,r=-.5;else if("#"===p)r=-.5,h=c;else if("%"===y)o=1-w,r=-1;else if("#"===y)o=1,r=-1,h=-w;else switch(a._defaultHorizontalAlignment){case"center":o=.5,r=-.5;break;case"end":o=1,r=-1}k.x1=o,k.x2=r,k.x3=h,B.x1="%"===H?I:0,B.x2="#"===H?I:0},_defaultHorizontalAlignment:"center",_defaultVerticalAlignment:"start"})});