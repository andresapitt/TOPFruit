define(["Ti/_/css","Ti/_/declare","Ti/_/dom","Ti/_/event","Ti/_/has","Ti/_/lang","Ti/_/style","Ti/_/Evented","Ti/UI","Ti/UI/Animation"],function(t,e,o,i,r,s,n,a,d,h){var u=window,c=o.unitize,l=o.computeSize,f=require.on,_=n.set,g=require.is,m=s.isDef,b={post:"_doBackground"},p=function(t,e){return(null===t||!g(t,"String")&&!g(t,"Number"))&&(t=void 0),t!==e&&!this._batchUpdateInProgress&&this._triggerLayout(),t},v={set:p},y="px",x=r("touch");return e("Ti._.UI.Element",a,{domType:null,domNode:null,_alive:1,constructor:function(){{var e=this,r=0;e.domNode=e._setFocusNode(o.create(e.domType||"div",{className:"TiUIElement "+t.clean(e.declaredClass),"data-widget-id":e.widgetId}))}e._children=[],f(e,"touchstart",e,"_doBackground"),f(e,"touchend",e,"_doBackground"),f(e.domNode,x?"touchstart":"mousedown",function(t){var o=[f(u,x?"touchmove":"mousemove",function(t){(x||r)&&(t._elements||(t._elements=[])).push(e)}),f(u,x?"touchend":"mouseup",function(t){r=0,(t._elements||(t._elements=[])).push(e),i.off(o)}),x&&f(u,"touchcancel",function(t){(t._elements||(t._elements=[])).push(e),i.off(o)})];r=1,(t._elements||(t._elements=[])).push(e)});var s=e.__values__.constants;e._layoutCoefficients={width:{x1:0,x2:0,x3:0},minWidth:{x1:0,x2:0,x3:0},sandboxWidth:{x1:0,x2:0,x3:0},height:{x1:0,x2:0,x3:0},minHeight:{x1:0,x2:0,x3:0},sandboxHeight:{x1:0,x2:0,x3:0},left:{x1:0,x2:0,x3:0},top:{x1:0,x2:0,x3:0,x4:0}},s.size={x:0,y:0,width:0,height:0},s.rect={x:0,y:0,width:0,height:0}},fireEvent:function(t,e){e=e||{};var o,i=e.bubbles;a.fireEvent.call(this,t,e),i&&!e.cancelBubble&&this.bubbleParent&&this._parent&&(m(e.x)&&(o=this.convertPointToView({x:e.x,y:e.y},this._parent),e.x=o?o.x:e.x,e.y=o?o.y:e.y),this._parent.fireEvent(t,e))},_setParent:function(t){this._parent=t},_add:function(t,e){t._hidden=e,t._setParent(this),this._children.push(t),this.containerNode.appendChild(t.domNode),t._triggerLayout()},_insertAt:function(t,e,o){var i=this._children;e>i.length||0>e||(e===i.length?this._add(t,o):(t._parent=this,this.containerNode.insertBefore(t.domNode,i[e].domNode),i.splice(e,0,t),this._triggerLayout()))},_remove:function(t){var e=this._children,i=e.indexOf(t);-1!==i&&(e.splice(i,1),t._setParent(),o.detach(t.domNode),this._triggerLayout())},_removeAllChildren:function(){for(var t=this._children;t.length;)this.remove(t[0]);this._triggerLayout()},destroy:function(){if(this._alive){for(var t=this._children;t.length;)t.splice(0,1)[0].destroy();this._parent&&this._parent._remove(this),this.domNode&&(o.destroy(this.domNode),this.domNode=null)}a.destroy.apply(this,arguments)},_isAttachedToActiveWin:function(){for(var t=!1,e=this;e;){if(e===d._container){t=!0;break}e=e._parent}return t},_needsMeasuring:!0,_triggerLayout:function(t){this._needsMeasuring=!0,this._isAttachedToActiveWin()&&(!this._batchUpdateInProgress||t)&&d._triggerLayout(this,t)},_hasSizeDimensions:function(){return this._hasSizeWidth()||this._hasSizeHeight()},_hasSizeHeight:function(){return isNaN(this._layoutCoefficients.height.x1)},_hasSizeWidth:function(){return isNaN(this._layoutCoefficients.width.x1)},startLayout:function(){this._batchUpdateInProgress=!0},finishLayout:function(){this._batchUpdateInProgress=!1,d._triggerLayout(this,!0)},updateLayout:function(t){this.startLayout();for(var e=0,o=t.length;o>e;e++)this[e]=t[e];this.finishLayout()},convertPointToView:function(t,e){function o(t,e,o){for(var i=e.x,r=e.y,s=o?1:-1;t;)i+=s*t.domNode.offsetLeft,r+=s*t.domNode.offsetTop,t=t._parent;return{x:i,y:r}}if(!this._isAttachedToActiveWin()||!e._isAttachedToActiveWin())return null;if(!t||!g(t.x,"Number")||!g(t.y,"Number"))throw new Error("Invalid point");if(!e.domNode)throw new Error("Invalid destination view");return o(e,o(this,t,!0),!1)},_getContentOffset:function(){return{x:0,y:0}},_computeGradient:function(){var t=this.backgroundGradient;colors=t.colors,type=t.type,cssVal=type+"-gradient(";var e=l(t.startPoint.x,this._measuredWidth),o=l(t.startPoint.y,this._measuredHeight),i=l("50%",this._measuredWidth),r=l("50%",this._measuredHeight),s=colors.length;if("linear"===type){var n,a,d=l(t.endPoint.x,this._measuredWidth),h=l(t.endPoint.y,this._measuredHeight);if(Math.abs(e-d)<.01)h>o?(n=o,a=h,cssVal+="270deg"):(n=h,a=o,cssVal+="90deg");else if(Math.abs(o-h)<.01)d>e?(n=e,a=d,cssVal+="0deg"):(n=d,a=e,cssVal+="180deg");else{var u=!1;if(e>d){u=!0;var c=e;e=d,d=c,c=o,o=h,h=c}var f=Math.atan2(h-o,d-e),m=Math.tan(f),b=Math.cos(f),p=r-i*m,v=(o-e*m-p)*b,x=v*Math.sin(f),k=v*b,e=e+x,o=o-k,d=d+x,h=h-k,N=Math.PI/2-f;if(f>0){var I=p*Math.sin(N),W=-I*Math.cos(N),w=I*Math.sin(N);n=Math.sqrt(Math.pow(e-W,2)+Math.pow(o-w,2)),a=Math.sqrt(Math.pow(d-W,2)+Math.pow(h-w,2))}else{var I=(this._measuredHeight-p)*Math.sin(N),W=-I*Math.cos(N),w=this._measuredHeight-I*Math.sin(N);n=Math.sqrt(Math.pow(e-W,2)+Math.pow(o-w,2)),a=Math.sqrt(Math.pow(d-W,2)+Math.pow(h-w,2))}f=u?f+Math.PI:f,cssVal+=Math.round(360*(2*Math.PI-f)/(2*Math.PI))+"deg"}for(var M=0;s>M;M++){var C=colors[M];g(C,"String")&&(C={color:C}),g(C.offset,"Number")||(C.offset=M/(s-1)),cssVal+=","+C.color+" "+Math.round(l(100*C.offset+"%",a-n)+n)+y}}else if("radial"===type){var T=Math.min(this._measuredWidth,this._measuredHeight),B=l(t.startRadius,T),S=l(t.endRadius,T),L=[],u=!1;if(B>S){var c=B;B=S,S=c,u=!0;for(var M=0;(s-2)/2>=M;M++){var P=s-M-1;L[M]=colors[P],L[P]=colors[M]}if(s%2===1){var A=Math.floor(s/2);L[A]=colors[A]}}else for(var M=0;s>M;M++)L[M]=colors[M];cssVal+=e+y+" "+o+y;for(var M=0;s>M;M++){var C=L[M];g(C,"String")&&(C={color:C});var H;H=g(C.offset,"Number")?u?s%2===1&&M===Math.floor(s/2)?C.offset:1-C.offset:C.offset:M/(s-1),cssVal+=","+C.color+" "+Math.round(l(100*H+"%",S-B)+B)+y}}require.config.vendorPrefixes.css.forEach(function(t){_(this.domNode,"backgroundImage",t+cssVal+")")},this)},_defaultBackgroundColor:void 0,_defaultBackgroundImage:void 0,_defaultBackgroundDisabledColor:void 0,_defaultBackgroundDisabledImage:void 0,_defaultBackgroundFocusedColor:void 0,_defaultBackgroundFocusedImage:void 0,_defaultBackgroundSelectedColor:void 0,_defaultBackgroundSelectedImage:void 0,_borderLeftWidth:0,_borderRightWidth:0,_borderTopWidth:0,_borderBottomWidth:0,_getBorderFromCSS:function(){setTimeout(s.hitch(this,function(){var t=u.getComputedStyle(this.domNode),e=parseInt(t["border-left-width"]),o=parseInt(t["border-right-width"]),i=parseInt(t["border-top-width"]),r=parseInt(t["border-bottom-width"]);isNaN(e)||isNaN(o)||isNaN(i)||isNaN(r)||(this.borderWidth=e===o&&e===i&&e===r?e:[e,o,i,r])}),1)},_doBackground:function(t){if(!this.backgroundGradient){t=t||{};var e,o=(t.type||"").match(/mouse(over|out)/),i=this.backgroundImage||this._defaultBackgroundImage||"none",r=this.backgroundColor||this._defaultBackgroundColor,s=this.backgroundRepeat,a=this.domNode.style;this._touching&&(r=this.backgroundSelectedColor||this._defaultBackgroundSelectedColor||r,i=this.backgroundSelectedImage||this._defaultBackgroundSelectedImage||i),o&&(this._over="over"===o[1]),!this._touching&&this.focusable&&this._over&&(r=this.backgroundFocusedColor||this._defaultBackgroundFocusedColor||r,i=this.backgroundFocusedImage||this._defaultBackgroundFocusedImage||i),this.enabled||(r=this.backgroundDisabledColor||this._defaultBackgroundDisabledColor||r,i=this.backgroundDisabledImage||this._defaultBackgroundDisabledImage||i),r=r||(i&&"none"!==i?"transparent":""),a.backgroundColor.toLowerCase()!==r.toLowerCase()&&(a.backgroundColor=r),i=n.url(i),a.backgroundImage.replace(/'|"/g,"").toLowerCase()!==i.toLowerCase()&&(a.backgroundImage=i),i&&(e=s?"repeat":"no-repeat",a.backgroundRepeat!==e&&(a.backgroundRepeat=e),e=s?"auto":"100% 100%",a.backgroundSize.replace(/(100%) 100%/,"$1")!==e&&(a.backgroundSize=e))}},_setFocusNode:function(t){var e=this._focus=this._focus||{};return e.node!==t&&(e.node&&(i.off(e.evts),i.off(e.evtsMore)),e.node=t,e.evts=[f(t,"focus",this,"_doBackground"),f(t,"blur",this,"_doBackground")]),t},show:function(){this.visible=!0},hide:function(){this.visible=!1},animate:function(t,e){return this._isAttachedToActiveWin()&&h._play(this,t&&"Ti.UI.Animation"===t.declaredClass?t:new h(t)).then(e)},_setTouchEnabled:function(t){var e,o=this._children,i=0,r=o.length;for(_(this.domNode,"pointerEvents",t?"auto":"none");r>i;i++)e=o[i],e._setTouchEnabled(t&&e.touchEnabled)},_measuredLeft:0,_measuredTop:0,_measuredWidth:0,_measuredHeight:0,_measuredSandboxWidth:0,_measuredSandboxHeight:0,constants:{size:{get:function(){return{x:0,y:0,width:this._measuredWidth,height:this._measuredHeight}}},rect:{get:function(){return{x:this._measuredLeft,y:this._measuredTop,width:this._measuredWidth,height:this._measuredHeight}}},parent:function(){return this._parent}},properties:{backgroundColor:b,backgroundDisabledColor:b,backgroundDisabledImage:b,backgroundFocusedColor:b,backgroundFocusedImage:b,backgroundGradient:{set:function(t){if(g(t.type,"String")&&g(t.colors,"Array")&&!(t.colors.length<2)){var e=t.type,o=t.startPoint,i=t.endPoint;if("linear"===e)o&&"x"in o&&"y"in o||(t.startPoint={x:"0%",y:"50%"}),i&&"x"in i&&"y"in i||(t.endPoint={x:"100%",y:"50%"});else{if("radial"!==e)return;o&&"x"in o&&"y"in o||(t.startPoint={x:"50%",y:"50%"})}return t}},post:function(){this.backgroundGradient&&this._computeGradient()}},backgroundImage:b,backgroundRepeat:b,backgroundSelectedColor:b,backgroundSelectedImage:b,borderColor:{set:function(t){return _(this.domNode,"borderColor",t),t}},borderRadius:{set:function(t){return _(this.domNode,"borderRadius",c(t)),t},value:0},borderWidth:{set:function(t,e){if(g(t,"Array")){if(4!==t.length)return e;_(this.domNode,{borderLeftWidth:(this._borderLeftWidth=t[0])+y,borderRightWidth:(this._borderRightWidth=t[1])+y,borderTopWidth:(this._borderTopWidth=t[2])+y,borderBottomWidth:(this._borderBottomWidth=t[3])+y}),this._borderSet=!0}else{if(isNaN(t))return e;_(this.domNode,"borderWidth",t+y),this._borderLeftWidth=this._borderRightWidth=this._borderTopWidth=this._borderBottomWidth=t,this._borderSet=!0}return t},post:p,value:0},bottom:v,bubbleParent:!0,center:v,color:{set:function(t){return _(this.domNode,"color",t)}},enabled:{post:"_doBackground",set:function(t){return this._focus.node.disabled=!t,t},value:!0},focusable:{value:!1,set:function(t){return o.attr[t?"set":"remove"](this._focus.node,"tabindex",0),t}},_minHeight:v,_maxHeight:v,height:v,left:v,opacity:{set:function(t){return _(this.domNode,"opacity",t)}},visible:{set:function(t,e){return t=!!t,t!==e&&(!t&&(this._lastDisplay=n.get(this.domNode,"display")),_(this.domNode,"display",t?this._lastDisplay||"":"none"),t&&void 0!==e&&this._triggerLayout()),t}},right:v,touchEnabled:{set:function(t){return this._setTouchEnabled(t),t},value:!0},top:v,transform:{set:function(t){return _(this.domNode,"transform",t&&t.toCSS()),this._curTransform=t}},_minWidth:v,_maxWidth:v,width:v,zIndex:v}})});