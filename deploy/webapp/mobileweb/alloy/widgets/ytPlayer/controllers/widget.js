function WPATH(e){var l=e.lastIndexOf("/"),o=-1===l?"ytPlayer/"+e:e.substring(0,l)+"/ytPlayer/"+e.substring(l+1);return o}function Controller(){function e(e){var o=Ti.Network.createHTTPClient();o.onload=function(){var e=this.responseText.substring(4,this.responseText.length),o=JSON.parse(e),t=null!=o.content.player_data.fmt_stream_map,n=t?o.content.player_data.fmt_stream_map[0].url:"";t||Ti.API.info("using low quality video because fmt_stream_map does not exist in json response, User-Agent probably is not being sent correctly"),console.info("stream url: "+n),l(n)},o.open("GET","http://m.youtube.com/watch?ajax=1&layout=mobile&tsp=1&utcoffset=330&v="+e),o.send()}function l(e){o.videoPlayer.setUrl(e),o.videoPlayer.addEventListener("complete",function(){Ti.API.info("video player complete"),t.close()}),o.videoPlayer.addEventListener("fullscreen",function(e){e.entering||(Ti.API.info("video player fullscreen exit"),t.close())})}new(require("alloy/widget"))("ytPlayer"),this.__widgetId="ytPlayer",require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="widget",arguments[0]?arguments[0].__parentSymbol:null,arguments[0]?arguments[0].$model:null,arguments[0]?arguments[0].__itemTemplate:null;var o=this,t={};o.__views.videoPlayer=Ti.Media.createVideoPlayer({backgroundColor:"#000",fullscreen:!0,autoplay:!0,scalingMode:Ti.Media.VIDEO_SCALING_ASPECT_FIT,mediaControlMode:Ti.Media.VIDEO_CONTROL_DEFAULT,id:"videoPlayer",ns:Ti.Media}),o.__views.videoPlayer&&o.addTopLevelView(o.__views.videoPlayer),t.destroy=function(){},_.extend(o,o.__views),t.isPlaying=!1,t.play=function(l){console.info("id: "+l),t.isPlaying=!0,e(l)},t.close=function(){Ti.API.info("closing video player"),o.videoPlayer.hide(),o.videoPlayer.release(),o.videoPlayer=null,t.isPlaying=!1},_.extend(o,t)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;